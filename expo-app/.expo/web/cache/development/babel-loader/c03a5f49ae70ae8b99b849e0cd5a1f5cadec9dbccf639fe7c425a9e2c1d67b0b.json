{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport React, { useEffect, useState } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport { auth, db } from \"../firebase/initFirebase\";\nimport { collection, query, orderBy, onSnapshot } from 'firebase/firestore';\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nfunction formatDate(ts) {\n  try {\n    var d = typeof ts === 'number' ? new Date(ts) : ts && ts.toDate ? ts.toDate() : new Date();\n    return d.toLocaleString();\n  } catch (e) {\n    return '';\n  }\n}\nexport default function HistoryScreen() {\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    items = _useState2[0],\n    setItems = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    searchQuery = _useState4[0],\n    setSearchQuery = _useState4[1];\n  useEffect(function () {\n    var unsub = null;\n    var user = auth.currentUser;\n    if (!user) {\n      setItems([]);\n      return;\n    }\n    var q = query(collection(db, 'users', user.uid, 'history'), orderBy('createdAt', 'desc'));\n    unsub = onSnapshot(q, function (snap) {\n      var arr = snap.docs.map(function (d) {\n        return _objectSpread({\n          id: d.id\n        }, d.data());\n      });\n      setItems(arr);\n    }, function () {});\n    return function () {\n      return unsub && unsub();\n    };\n  }, []);\n  var filtered = searchQuery.trim() === '' ? items : items.filter(function (it) {\n    return (it.patientName || '').toLowerCase().includes(searchQuery.trim().toLowerCase());\n  });\n  return _jsxs(View, {\n    style: styles.container,\n    children: [_jsx(Text, {\n      style: styles.title,\n      children: \"\\u0418\\u0441\\u0442\\u043E\\u0440\\u0438\\u044F \\u0440\\u0430\\u0441\\u0447\\u0451\\u0442\\u043E\\u0432\"\n    }), _jsx(TextInput, {\n      style: styles.search,\n      placeholder: \"\\u041F\\u043E\\u0438\\u0441\\u043A \\u043F\\u043E \\u0438\\u043C\\u0435\\u043D\\u0438 \\u043F\\u0430\\u0446\\u0438\\u0435\\u043D\\u0442\\u0430\",\n      value: searchQuery,\n      onChangeText: setSearchQuery\n    }), items.length === 0 ? _jsx(View, {\n      style: styles.empty,\n      children: _jsx(Text, {\n        style: styles.emptyText,\n        children: \"\\u0418\\u0441\\u0442\\u043E\\u0440\\u0438\\u044F \\u043F\\u0443\\u0441\\u0442\\u0430\"\n      })\n    }) : _jsx(FlatList, {\n      data: filtered,\n      keyExtractor: function keyExtractor(i) {\n        return i.id;\n      },\n      renderItem: function renderItem(_ref) {\n        var _ref2, _item$weightRaw, _item$weightUnit, _item$age, _ref3, _item$creatinineRaw, _item$creatinineUnit;\n        var item = _ref.item;\n        return _jsxs(View, {\n          style: styles.card,\n          children: [item.patientName ? _jsx(Text, {\n            style: styles.cardPatient,\n            children: item.patientName\n          }) : null, _jsxs(Text, {\n            style: styles.cardValue,\n            children: [item.result, \" mL/min\"]\n          }), _jsx(Text, {\n            style: styles.cardMeta,\n            children: ((_ref2 = (_item$weightRaw = item.weightRaw) != null ? _item$weightRaw : item.weightKg) != null ? _ref2 : '') + \" \" + ((_item$weightUnit = item.weightUnit) != null ? _item$weightUnit : 'kg') + \" \\xB7 \" + ((_item$age = item.age) != null ? _item$age : '') + \" y \\xB7 \" + ((_ref3 = (_item$creatinineRaw = item.creatinineRaw) != null ? _item$creatinineRaw : item.creatinineMgDl) != null ? _ref3 : '') + \" \" + ((_item$creatinineUnit = item.creatinineUnit) != null ? _item$creatinineUnit : 'mg/dL')\n          }), _jsx(Text, {\n            style: styles.cardDate,\n            children: formatDate(item.createdAt)\n          })]\n        });\n      }\n    })]\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    padding: 20,\n    backgroundColor: '#fff',\n    flex: 1\n  },\n  title: {\n    fontSize: 20,\n    fontWeight: '700',\n    marginBottom: 12\n  },\n  card: {\n    padding: 12,\n    borderRadius: 10,\n    backgroundColor: '#f8fafc',\n    marginBottom: 10\n  },\n  cardValue: {\n    fontSize: 18,\n    fontWeight: '700'\n  },\n  cardPatient: {\n    fontSize: 14,\n    fontWeight: '700',\n    color: '#333',\n    marginBottom: 6\n  },\n  cardMeta: {\n    color: '#555',\n    marginTop: 6\n  },\n  cardDate: {\n    color: '#999',\n    marginTop: 8,\n    fontSize: 12\n  },\n  empty: {\n    padding: 40,\n    alignItems: 'center'\n  },\n  emptyText: {\n    color: '#666'\n  },\n  search: {\n    borderWidth: 1,\n    borderColor: '#eee',\n    padding: 8,\n    borderRadius: 8,\n    marginBottom: 12\n  }\n});","map":{"version":3,"names":["React","useEffect","useState","View","Text","FlatList","StyleSheet","TextInput","auth","db","collection","query","orderBy","onSnapshot","jsx","_jsx","jsxs","_jsxs","formatDate","ts","d","Date","toDate","toLocaleString","e","HistoryScreen","_useState","_useState2","_slicedToArray","items","setItems","_useState3","_useState4","searchQuery","setSearchQuery","unsub","user","currentUser","q","uid","snap","arr","docs","map","_objectSpread","id","data","filtered","trim","filter","it","patientName","toLowerCase","includes","style","styles","container","children","title","search","placeholder","value","onChangeText","length","empty","emptyText","keyExtractor","i","renderItem","_ref","_ref2","_item$weightRaw","_item$weightUnit","_item$age","_ref3","_item$creatinineRaw","_item$creatinineUnit","item","card","cardPatient","cardValue","result","cardMeta","weightRaw","weightKg","weightUnit","age","creatinineRaw","creatinineMgDl","creatinineUnit","cardDate","createdAt","create","padding","backgroundColor","flex","fontSize","fontWeight","marginBottom","borderRadius","color","marginTop","alignItems","borderWidth","borderColor"],"sources":["C:/Study/MedicineCalc/MedicineCaclc/expo-app/screens/HistoryScreen.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { View, Text, FlatList, StyleSheet, TextInput } from 'react-native';\r\nimport { auth, db } from '../firebase/initFirebase';\r\nimport { collection, query, orderBy, onSnapshot } from 'firebase/firestore';\r\n\r\nfunction formatDate(ts: any) {\r\n  try {\r\n    const d = typeof ts === 'number' ? new Date(ts) : ts && ts.toDate ? ts.toDate() : new Date();\r\n    return d.toLocaleString();\r\n  } catch (e) { return '' }\r\n}\r\n\r\ninterface HistoryItem {\r\n  id: string;\r\n  patientName?: string;\r\n  result?: number;\r\n  weightRaw?: number;\r\n  weightKg?: number;\r\n  weightUnit?: string;\r\n  age?: number;\r\n  creatinineRaw?: number;\r\n  creatinineMgDl?: number;\r\n  creatinineUnit?: string;\r\n  createdAt?: any;\r\n}\r\n\r\nexport default function HistoryScreen() {\r\n  const [items, setItems] = useState<HistoryItem[]>([]);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n\r\n  useEffect(() => {\r\n    let unsub: (() => void) | null = null;\r\n    const user = auth.currentUser;\r\n    if (!user) {\r\n      setItems([]);\r\n      return;\r\n    }\r\n    const q = query(collection(db, 'users', user.uid, 'history'), orderBy('createdAt', 'desc'));\r\n    unsub = onSnapshot(q, snap => {\r\n      const arr = snap.docs.map(d => ({ id: d.id, ...d.data() } as HistoryItem));\r\n      setItems(arr);\r\n    }, () => { });\r\n    return () => unsub && unsub();\r\n  }, []);\r\n\r\n  const filtered = searchQuery.trim() === '' ? items : items.filter(it => (it.patientName || '').toLowerCase().includes(searchQuery.trim().toLowerCase()));\r\n\r\n  return (\r\n    <View style={styles.container}>\r\n      <Text style={styles.title}>История расчётов</Text>\r\n      <TextInput style={styles.search} placeholder=\"Поиск по имени пациента\" value={searchQuery} onChangeText={setSearchQuery} />\r\n      {items.length === 0 ? (\r\n        <View style={styles.empty}><Text style={styles.emptyText}>История пуста</Text></View>\r\n      ) : (\r\n        <FlatList data={filtered} keyExtractor={i => i.id} renderItem={({ item }) => (\r\n          <View style={styles.card}>\r\n            {item.patientName ? <Text style={styles.cardPatient}>{item.patientName}</Text> : null}\r\n            <Text style={styles.cardValue}>{item.result} mL/min</Text>\r\n            <Text style={styles.cardMeta}>{`${item.weightRaw ?? item.weightKg ?? ''} ${item.weightUnit ?? 'kg'} · ${item.age ?? ''} y · ${item.creatinineRaw ?? item.creatinineMgDl ?? ''} ${item.creatinineUnit ?? 'mg/dL'}`}</Text>\r\n            <Text style={styles.cardDate}>{formatDate(item.createdAt)}</Text>\r\n          </View>\r\n        )} />\r\n      )}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: { padding: 20, backgroundColor: '#fff', flex: 1 },\r\n  title: { fontSize: 20, fontWeight: '700', marginBottom: 12 },\r\n  card: { padding: 12, borderRadius: 10, backgroundColor: '#f8fafc', marginBottom: 10 },\r\n  cardValue: { fontSize: 18, fontWeight: '700' },\r\n  cardPatient: { fontSize: 14, fontWeight: '700', color: '#333', marginBottom: 6 },\r\n  cardMeta: { color: '#555', marginTop: 6 },\r\n  cardDate: { color: '#999', marginTop: 8, fontSize: 12 },\r\n  empty: { padding: 40, alignItems: 'center' },\r\n  emptyText: { color: '#666' }\r\n  ,search: { borderWidth:1, borderColor:'#eee', padding:8, borderRadius:8, marginBottom:12 }\r\n});\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}